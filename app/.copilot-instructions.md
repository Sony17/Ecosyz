Project: Open Idea (open-source).
Constraints:
- Use only open providers (OpenAlex, arXiv, Zenodo, Software Heritage, CKAN).
- Next.js (App Router) + TypeScript + Next API routes.
- Federated metasearch: fan-out → normalize → dedupe → score.
- 8s timeouts, per-provider try/catch, in-memory LRU cache.
- No proprietary LLM calls; put TODO stubs for local inference.
- Add SPDX headers; always include license field in results.

1) Create types file

Prompt in Copilot Chat:
“Create /src/types/resource.ts with the Resource and ResourceType interfaces as per .copilot-instructions.md. Add JSDoc.”

2) Generate provider clients

Prompt:
“Create provider modules with minimal dependencies and 8s timeouts:

/app/api/search/providers/openalex.ts exports searchOpenAlex(q: string): Promise<Resource[]>

/app/api/search/providers/arxiv.ts exports searchArxiv(q: string): Promise<Resource[]> (parse Atom XML)

/app/api/search/providers/zenodo.ts exports searchZenodo(q: string): Promise<Resource[]>

/app/api/search/providers/swh.ts exports searchSoftwareHeritage(q: string): Promise<Resource[]>
Map to Resource exactly; include license if present; keep functions pure; add simple unitable helpers.”

3) Federated route

Prompt:
“Create /app/api/search/route.ts (Next.js App Router). Query params: q, type in {all,paper,dataset,code}. Fan-out to the four providers in parallel (with try/catch per provider). Normalize, dedupe by DOI→SWHID→URL→(source+title). Add scoring: text/title match, recency, quality. Sort and return top 30 as JSON. Add in-memory LRU cache (5 min).”

4) UI page

Prompt:
“Create /app/search/page.tsx: input bar, filter chips (All/Papers/Datasets/Code), results as cards with source badge, license pill, authors/year, buttons: Open, Save (stub), Summarize (stub). Include loading and empty states. Minimal Tailwind only.”

5) Tests

Prompt:
“Generate /tests/search.route.test.ts using Vitest. Mock provider modules to simulate: normal responses, duplicate DOIs, one provider timing out. Assert dedupe, top-30 cap, and that timeouts degrade gracefully.”

6) Docs & ADR

Prompt:
“Create /docs/specs/search-v0.md describing scope, inputs/outputs, provider endpoints, rate limits, scoring, and error handling. Create /docs/adr/ADR-0001-federated-open-metasearch.md with context, decision, alternatives, consequences.”

7) Hardening refactor (optional)

Prompt:
“Refactor: extract fetchWithTimeout, normalize, and score helpers to /app/api/search/lib/*.ts. Add JSDoc and tighten types. Keep behavior identical.”